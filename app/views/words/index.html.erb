<script>
//更新
function koshin(){
  location.reload();
}
</script>

<% breadcrumb :words %>

<h3>尻取りしましょ</h3>

<% unless @new_word.nil? %>
  <h1>【<%= @new_word.content %>】</h1>
  <form>他の人が新たに尻取りしてないか<input type="button"  value="確かめて" onclick="koshin()"></form>
<% end %>

<p>

<%= form_for(@word) do |f| %>
 <!--楽観的ロック!-->
 <!-- <%= f.hidden_field :lock_version %> -->
  <% if @word.errors.any? %>
    <div id="error_explanation">
      <h2><%= @word.errors.count %>件のエラーがあります。</h2>

      <ul>
      <% @word.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

<div class="row">

  <div class="form-group col-xs-6">
    <form class="form-inline">
      <%= f.label :content, '次のことばは…' %>
      <%= f.text_field :content, class: 'form-control' %>
      <%= f.submit '尻取り！', class: 'btn btn-primary' %>
    </form>
  </div>

  <div class="form-group col-xs-3 input-sm">
      <%= f.label :category, '分野決める？' %>(空っぽでもいい)
      <%= f.text_field :category, class: 'form-control' %>
  </div>

<% end %>

</div>

<table class="table table-striped">
  <thead>
    <tr class="input-sm">
    <th>尻取りした人</th>
    <th>尻取り</th>
    <th>分野</th>
    <th>用例数</th>
    <th>用例</th>
    </tr>
  </thead>

  <tbody>
  <% @words.each do |word| %>

    <% if current_user.username == "名無しの権兵衛" %>
     <tr>
     <td><%= word.user.username %></td>
     <td>【<%= word.content %>】</td>
     <td class="input-sm"><%= word.category %></td>
     <td></td>
     <td>ログインして！</td>
    <% else %>
     <td><%= word.user.username %></td>
     <td>【<%= word.content %>】</td>
     <td class="input-sm"><%= word.category %></td>
     <%
       youreis = []
       w = Word.where(content: word.content)
       w.each do |a|
        # youreis << a.youreis.order(id: "DESC").page(params[:page]).per(20)
        youreis << a.youreis.order(id: "DESC")
       end
     %>
     <% if youreis != nil %>
     <% count = 0 %>
     <% youreis.each do |c| %>
      <% count += c.count %>
     <% end %>
     <td><%= count %></td>
     <td><%= link_to "➡", word, class: "btn btn-primary" %></td>
    <% end %>
   </tr>
   <% end %>

  <% end %>
  </tbody>
</table>

<div align=center>
  <p><%= paginate @words, :window => 10 %><br>
</div>

<!-- <p>ユーザーID（開発用に表示）：<%#= current_user.id %>
<%#= link_to current_user.username, words_path(current_user) %></p> -->
